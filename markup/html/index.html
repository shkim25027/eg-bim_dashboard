<!doctype html>
<html lang="ko">
  <head>
    @@include("_include/_head.html")
  </head>
  <body>
    <div class="wrap">
      @@include("_include/_header.html")
      <!-- container -->
      <div class="container">
        <section>
          <h2>세로 막대 차트</h2>
          <div>
            <canvas id="chart-columnLine"></canvas>
          </div>
        </section>
        <section class="sales">
          <h2>라인+영역 차트</h2>
          <div>
            <canvas
              id="chart-linearea"
              style="width: 500px; height: 500px"
            ></canvas>
          </div>
        </section>
        <section>
          <h2>가로 막대 차트</h2>
          <div><canvas id="chart-bar"></canvas></div>
        </section>
        <section>
          <h2>도넛 차트</h2>
          <div>
            <canvas id="chart-doughnut"></canvas>
          </div>
        </section>
        <section></section>
      </div>
    </div>

    <script>
      // ---------------------------
      // 공통 색상 그라데이션
      // ---------------------------
      const gradientColors = [
        { stop: 0, color: "#918050" },
        { stop: 0.3399, color: "#968860" },
        { stop: 0.4981, color: "#8C7D50" },
        { stop: 1, color: "#6D5A21" },
      ];

      // ---------------------------
      // 공통: 막대 그라데이션 생성
      // ---------------------------
      function createGradient(ctx, bar, colors, isHorizontal = false) {
        if (!bar || (isHorizontal ? !bar.height : !bar.width))
          return colors[0].color;
        const gradient = isHorizontal
          ? ctx.createLinearGradient(0, bar.y, 0, bar.y + bar.height)
          : ctx.createLinearGradient(bar.x, 0, bar.x + bar.width, 0);
        colors.forEach((c) => gradient.addColorStop(c.stop, c.color));
        return gradient;
      }

      // ---------------------------
      // 공통: 값 표시 플러그인 (세로/가로 구분)
      // ---------------------------
      function createValuePlugin(isHorizontal = false, padding = 10) {
        return {
          id: "valuePlugin",
          afterDatasetsDraw(chart) {
            const ctx = chart.ctx;
            chart.data.datasets.forEach((dataset, i) => {
              chart.getDatasetMeta(i).data.forEach((bar, index) => {
                const value = dataset.data[index];

                // 0이거나 값이 없으면 표시 안 함
                if (!value || value === 0) return;

                ctx.fillStyle = "#000";
                ctx.font = "bold 14px Arial";

                let xPos, yPos;

                if (isHorizontal) {
                  // 가로 막대: 막대 끝(오른쪽)에 표시
                  ctx.textAlign = "left";
                  ctx.textBaseline = "middle";
                  xPos = bar.x + bar.width + padding;
                  yPos = bar.y + bar.height / 2;
                } else {
                  // 세로 막대: 막대 끝(위쪽)에 표시
                  ctx.textAlign = "center";
                  ctx.textBaseline = "bottom";
                  xPos = bar.x;
                  yPos = bar.y - padding;
                }

                ctx.fillText(value, xPos, yPos);
              });
            });
          },
        };
      }

      // ---------------------------
      // 세로 막대 차트
      // ---------------------------
      const columnCtx = document
        .getElementById("chart-columnLine")
        .getContext("2d");
      new Chart(columnCtx, {
        type: "bar",
        data: {
          labels: [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10",
            "11",
            "12",
          ],
          datasets: [
            {
              label: "판매량",
              data: [0, 0, 0, 0, 0, 0, 0, 0, 100, 1000, 100, 0],
              backgroundColor: function (context) {
                const chart = context.chart;
                const meta = chart.getDatasetMeta(context.datasetIndex);
                const bar = meta.data[context.dataIndex];
                return createGradient(chart.ctx, bar, gradientColors);
              },
              borderRadius: {
                topLeft: 2,
                topRight: 2,
                bottomLeft: 0,
                bottomRight: 0,
              },
              borderSkipped: false,
            },
          ],
        },
        options: {
          responsive: true,
          plugins: {
            legend: { display: false },
            tooltip: { enabled: true },
          },
          scales: {
            y: {
              display: false,
              beginAtZero: true,
              grid: { color: "#eee" },
              ticks: {
                display: false,
              },
            },
            x: {
              grid: {
                drawTicks: false,
              },
              ticks: {
                color: function (context) {
                  if (context.tick.label === "11") {
                    return "#121212";
                  }
                  return "rgba(18, 18, 18, 0.60)";
                },
                font: function (context) {
                  if (context.tick.label === "11") {
                    return {
                      weight: "bold",
                      size: 12,
                    };
                  }
                  return {
                    weight: "normal",
                    size: 12,
                  };
                },
              },
              border: {
                display: true,
                dash: [3, 3],
                color: "rgba(0, 0, 0, 0.30)",
                width: 1,
              },
            },
          },
        },
        plugins: [createValuePlugin(false, 10)], // 세로 막대, padding 10px
      });

      // ---------------------------
      // 가로 막대 차트
      // ---------------------------
      const barCtx = document.getElementById("chart-bar").getContext("2d");
      new Chart(barCtx, {
        type: "bar",
        data: {
          labels: ["1주차", "2주차", "3주차", "4주차"],
          datasets: [
            {
              label: "판매량",
              data: [12, 19, 7, 15],
              backgroundColor: function (context) {
                const chart = context.chart;
                const meta = chart.getDatasetMeta(context.datasetIndex);
                const bar = meta.data[context.dataIndex];
                return createGradient(chart.ctx, bar, gradientColors, true);
              },
              borderRadius: {
                topLeft: 0,
                topRight: 8,
                bottomLeft: 0,
                bottomRight: 8,
              },
              borderSkipped: false,
            },
          ],
        },
        options: {
          indexAxis: "y",
          responsive: true,
          plugins: { legend: { display: false } },
          scales: {
            x: {
              display: false,
              beginAtZero: true,
              grid: { color: "#eee" },
              ticks: {
                display: false,
              },
            },
            y: {
              grid: {
                drawTicks: false,
              },
              border: {
                display: false,
                dash: [3, 3],
                color: "rgba(0, 0, 0, 0.30)",
                width: 1,
              },
              ticks: {
                color: function (context) {
                  if (context.tick.label === "3주차") {
                    return "#121212";
                  }
                  return "rgba(18, 18, 18, 0.60)";
                },
                font: function (context) {
                  if (context.tick.label === "3주차") {
                    return {
                      weight: "bold",
                      size: 12,
                    };
                  }
                  return {
                    weight: "normal",
                    size: 12,
                  };
                },
              },
            },
          },
        },
        plugins: [createValuePlugin(true, 10)], // 가로 막대, padding 10px
      });

      // ---------------------------
      // 라인+영역 차트
      // ---------------------------
      const lineCtx = document
        .getElementById("chart-linearea")
        .getContext("2d");

      // 곡선 모드
      const isCurve = false;

      // radial gradient 포인트 색상 함수
      function radialDotGradient(context) {
        const chart = context.chart;
        const element = context.element;

        if (!element || !element.x || !element.y || !element.radius) {
          return "#C1A770";
        }

        const { x, y } = element;
        const radius = element.radius;

        const grad = chart.ctx.createRadialGradient(x, y, 0, x, y, radius);
        grad.addColorStop(0.0648, "#FAE2B0");
        grad.addColorStop(0.3914, "#C1A770");
        return grad;
      }

      new Chart(lineCtx, {
        type: "line",
        data: {
          labels: [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10",
            "11",
            "12",
          ],
          datasets: [
            {
              label: "판매량",
              data: [
                350, 400, 380, 450, 520, 300, 280, 1000, 490, 350, 450, 600,
              ],
              fill: true,
              backgroundColor: function (context) {
                const chart = context.chart;
                const gradient = chart.ctx.createLinearGradient(
                  0,
                  0,
                  0,
                  chart.height
                );
                gradient.addColorStop(0, "rgba(145,128,80,0.6)");
                gradient.addColorStop(0.8, "rgba(145,128,80,0)");
                return gradient;
              },
              borderColor: "#918050",
              borderWidth: 2,
              tension: isCurve ? 0.4 : 0,
              pointBackgroundColor: radialDotGradient,
              pointRadius: 4,
              pointHoverRadius: 6,
            },
            {
              label: "매출",
              data: [450, 250, 280, 270, 280, 290, 300, 290, 10, 350, 320, 340],
              fill: true,
              backgroundColor: function (context) {
                const chart = context.chart;
                const gradient = chart.ctx.createLinearGradient(
                  0,
                  0,
                  0,
                  chart.height
                );
                gradient.addColorStop(0, "rgba(36,148,115,0.6)");
                gradient.addColorStop(0.9, "rgba(36,148,115,0)");
                return gradient;
              },
              borderColor: "#249473",
              borderWidth: 2,
              tension: isCurve ? 0.4 : 0,
              pointBackgroundColor: radialDotGradient,
              pointRadius: 4,
              pointHoverRadius: 6,
            },
          ],
        },
        options: {
          responsive: true,
          plugins: { legend: { display: true } },
          layout: {
            padding: {
              top: 50, // 상단 패딩
              bottom: 10, // 하단 패딩
              left: 30, // 왼쪽 패딩 (Y축과 차트 사이)
              right: 30, // 오른쪽 패딩
            },
          },
          scales: {
            y: {
              min: 0, // 최소값
              max: 1200, // 최대값
              ticks: {
                maxTicksLimit: 4, // 최대 5개의 Y축 라벨/선 표시
              },
              beginAtZero: true,
              grid: { color: "#eee" },
            },
            x: {
              grid: { color: "#eee" },
              border: {
                display: true,
                dash: [3, 3],
                color: "rgba(0, 0, 0, 0.30)",
                width: 1,
              },
              ticks: {
                color: function (context) {
                  if (context.tick.label === "11") {
                    return "#121212";
                  }
                  return "rgba(18, 18, 18, 0.60)";
                },
                font: function (context) {
                  if (context.tick.label === "11") {
                    return {
                      weight: "bold",
                      size: 12,
                    };
                  }
                  return {
                    weight: "normal",
                    size: 12,
                  };
                },
              },
            },
          },
        },
      });

      // ---------------------------
      // 도넛 차트
      // ---------------------------
      const doughnutCtx = document
        .getElementById("chart-doughnut")
        .getContext("2d");

      const totalCenterPlugin = {
        id: "totalCenter",
        beforeDraw(chart) {
          const {
            ctx,
            chartArea: { width, height },
          } = chart;
          ctx.save();
          ctx.font = "bold 24px Arial";
          ctx.fillStyle = "#333";
          ctx.textAlign = "center";
          ctx.textBaseline = "middle";
          const total = chart.data.datasets[0].data.reduce((a, b) => a + b, 0);
          ctx.fillText(total, width / 2, height / 2);
          ctx.restore();
        },
      };

      new Chart(doughnutCtx, {
        type: "doughnut",
        data: {
          labels: ["일반", "교육", "공공", "기타"],
          datasets: [
            {
              data: [139, 14, 12, 3],
              backgroundColor: ["#249473", "#EC8F53", "#90C9FF", "#C1A770"],
              borderWidth: 0,
            },
          ],
        },
        options: {
          responsive: true,
          plugins: { legend: { position: "bottom" } },
          cutout: "60%",
        },
        plugins: [totalCenterPlugin],
      });
    </script>
  </body>
</html>
