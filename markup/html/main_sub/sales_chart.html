<section class="card sales">
  <div class="card-header">
    <h3>연간 영업 판매 현황<span class="tail"></span></h3>
  </div>
  <div class="card-body">
    <div class="stat-row sales">
      <div class="label-box">
        <span class="label">영업 업체수</span>
        <span class="change-up">전월대비 <em>53</em></span>
      </div>
      <div><span class="big-num">148</span><span class="unit">개</span></div>
    </div>
  </div>
  <div class="chart-wrap">
    <div class="legend">
      <span class="unit">(단위:업체수)</span>
    </div>
    <div class="chart-body">
      <canvas id="industry_chart"></canvas>
    </div>
    <div class="chart-body">
      <canvas id="institution_chart"></canvas>
    </div>
  </div>
</section>
<script>
  (() => {
    let industryInstance = null;
    let institutionInstance = null;
    // 차트 생성 함수
    function createIndustryChart() {
      const industry_chart = document.getElementById("industry_chart");
      const institution_chart = document.getElementById("institution_chart");

      // 기존 차트가 있으면 제거
      if (industryInstance) {
        industryInstance.destroy();
      }

      industryInstance = new Chart(industry_chart, {
        type: "doughnut",
        data: {
          labels: ["설계", "교육", "제작", "감리", "시공"],
          datasets: [
            {
              data: [162, 305, 36, 72, 15],
              backgroundColor: [
                "#B66532",
                "#D08A5D",
                "#8F4818",
                "#5F2F0E",
                "#45220A",
              ],
              borderWidth: 2,
              borderColor: "#fff",
              rotation: 145,
            },
          ],
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          cutout: "50%",
          layout: {
            padding: { top: 40, bottom: 40, left: 0, right: 0 },
          },
          plugins: {
            legend: { display: false },
            tooltip: { enabled: false },
          },
        },
        plugins: [totalCenterPluginFactory("산업/업종별"), externalLabelPlugin],
      });

      // 기존 차트가 있으면 제거
      if (institutionInstance) {
        institutionInstance.destroy();
      }
      institutionInstance = new Chart(institution_chart, {
        type: "doughnut",
        data: {
          labels: ["일반", "교육기관", "공공기관", "기타"],
          datasets: [
            {
              data: [343, 305, 18, 19],
              backgroundColor: ["#C4964B", "#885D1A", "#5C3E0F", "#3C2500"],
              borderWidth: 2,
              borderColor: "#fff",
              rotation: 145,
            },
          ],
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          cutout: "50%",
          layout: {
            padding: { top: 40, bottom: 40, left: 0, right: 0 },
          },
          plugins: {
            legend: { display: false },
            tooltip: { enabled: false },
          },
        },
        plugins: [totalCenterPluginFactory("기관별"), externalLabelPlugin],
      });
    }

    // 초기 차트 생성
    createIndustryChart();
  })();
</script>
