<!doctype html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Chart.js Dashboard Example</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
      body {
        font-family: Arial, sans-serif;
        padding: 20px;
      }
      canvas {
        max-width: 600px;
        margin-bottom: 50px;
      }
    </style>
  </head>
  <body>
    <h2>세로 막대 차트</h2>
    <canvas id="columnChart"></canvas>

    <h2>가로 막대 차트</h2>
    <canvas id="barChart"></canvas>

    <h2>도넛 차트</h2>
    <canvas id="doughnutChart"></canvas>

    <h2>라인+영역 차트</h2>
    <canvas id="lineAreaChart"></canvas>

    <script>
      // ---------------------------
      // 공통 색상 그라데이션
      // ---------------------------
      const gradientColors = [
        { stop: 0, color: "#918050" },
        { stop: 0.3399, color: "#968860" },
        { stop: 0.4981, color: "#8C7D50" },
        { stop: 1, color: "#6D5A21" },
      ];

      // ---------------------------
      // 공통: 막대 그라데이션 생성
      // ---------------------------
      function createGradient(ctx, bar, colors, isHorizontal = false) {
        if (!bar || (isHorizontal ? !bar.height : !bar.width))
          return colors[0].color;
        const gradient = isHorizontal
          ? ctx.createLinearGradient(0, bar.y, 0, bar.y + bar.height)
          : ctx.createLinearGradient(bar.x, 0, bar.x + bar.width, 0);
        colors.forEach((c) => gradient.addColorStop(c.stop, c.color));
        return gradient;
      }

      // ---------------------------
      // 공통: 값 표시 플러그인
      // ---------------------------
      function createValuePlugin(align = "center", offsetX = 0, offsetY = -8) {
        return {
          id: "valuePlugin",
          afterDatasetsDraw(chart) {
            const ctx = chart.ctx;
            chart.data.datasets.forEach((dataset, i) => {
              chart.getDatasetMeta(i).data.forEach((bar, index) => {
                const value = dataset.data[index];
                ctx.fillStyle = "#000";
                ctx.font = "bold 14px Arial";
                ctx.textAlign = align;
                ctx.textBaseline = "middle";
                ctx.fillText(
                  value,
                  bar.x + offsetX,
                  bar.y + bar.height / 2 + offsetY
                );
              });
            });
          },
        };
      }

      // ---------------------------
      // 공통: 막대 차트 생성
      // ---------------------------
      function createBarChart(
        ctx,
        labels,
        dataValues,
        options = {},
        plugins = [],
        isHorizontal = false
      ) {
        return new Chart(ctx, {
          type: "bar",
          data: {
            labels: labels,
            datasets: [
              {
                label: "판매량",
                data: dataValues,
                backgroundColor: function (context) {
                  const chart = context.chart;
                  const meta = chart.getDatasetMeta(context.datasetIndex);
                  const bar = meta.data[context.dataIndex];
                  return createGradient(
                    chart.ctx,
                    bar,
                    gradientColors,
                    isHorizontal
                  );
                },
                borderRadius: isHorizontal
                  ? { topLeft: 8, topRight: 8, bottomLeft: 0, bottomRight: 0 }
                  : 8,
                borderSkipped: false,
              },
            ],
          },
          options: options,
          plugins: plugins,
        });
      }

      // ---------------------------
      // 세로 막대 차트
      // ---------------------------
      const columnCtx = document.getElementById("columnChart").getContext("2d");
      createBarChart(
        columnCtx,
        ["A", "B", "C", "D", "E"],
        [12, 19, 7, 15, 9],
        {
          responsive: true,
          plugins: { legend: { display: false }, tooltip: { enabled: true } },
          scales: {
            y: {
              beginAtZero: true,
              grid: { color: "#eee" },
              ticks: { color: "#333", font: { size: 12 } },
            },
            x: { ticks: { color: "#333", font: { size: 12 } } },
          },
        },
        [createValuePlugin("center", 0, -8)],
        false
      );

      // ---------------------------
      // 가로 막대 차트
      // ---------------------------
      const barCtx = document.getElementById("barChart").getContext("2d");
      createBarChart(
        barCtx,
        ["A", "B", "C", "D"],
        [12, 19, 7, 15],
        {
          indexAxis: "y",
          responsive: true,
          plugins: { legend: { display: false } },
          scales: {
            x: { beginAtZero: true, grid: { color: "#eee" } },
            y: { ticks: { color: "#333", font: { size: 12 } } },
          },
        },
        [createValuePlugin("left", 5, 0)],
        true
      );

      // ---------------------------
      // 도넛 차트 중앙 총합 표시 플러그인
      // ---------------------------
      const totalCenterPlugin = {
        id: "totalCenter",
        beforeDraw(chart) {
          const {
            ctx,
            chartArea: { width, height },
          } = chart;
          ctx.save();
          ctx.font = "bold 24px Arial";
          ctx.fillStyle = "#333";
          ctx.textAlign = "center";
          ctx.textBaseline = "middle";
          const total = chart.data.datasets[0].data.reduce((a, b) => a + b, 0);
          ctx.fillText(total, width / 2, height / 2);
          ctx.restore();
        },
      };

      // ---------------------------
      // 도넛 차트
      // ---------------------------
      const doughnutCtx = document
        .getElementById("doughnutChart")
        .getContext("2d");
      new Chart(doughnutCtx, {
        type: "doughnut",
        data: {
          labels: ["A", "B", "C", "D"],
          datasets: [
            {
              data: [12, 19, 7, 15],
              backgroundColor: ["#918050", "#968860", "#8C7D50", "#6D5A21"],
              borderWidth: 0,
            },
          ],
        },
        options: {
          responsive: true,
          plugins: { legend: { position: "bottom" } },
          cutout: "60%",
        },
        plugins: [totalCenterPlugin],
      });

      // ---------------------------
      // 라인+영역 차트
      // ---------------------------
      const lineCtx = document.getElementById("lineAreaChart").getContext("2d");

      // 곡선 모드
      const isCurve = false;

      // radial gradient 포인트 색상 함수
      function radialDotGradient(context) {
        const chart = context.chart;
        const element = context.element;

        if (!element || !element.x || !element.y || !element.radius) {
          return "#C1A770";
        }

        const { x, y } = element;
        const radius = element.radius;

        const grad = chart.ctx.createRadialGradient(x, y, 0, x, y, radius);
        grad.addColorStop(0.0648, "#FAE2B0");
        grad.addColorStop(0.3914, "#C1A770");
        return grad;
      }

      new Chart(lineCtx, {
        type: "line",
        data: {
          labels: ["A", "B", "C", "D", "E"],
          datasets: [
            {
              label: "판매량",
              data: [12, 19, 7, 15, 10],
              fill: true,
              backgroundColor: function (context) {
                const chart = context.chart;
                const gradient = chart.ctx.createLinearGradient(
                  0,
                  0,
                  0,
                  chart.height
                );
                gradient.addColorStop(0, "rgba(145,128,80,0.6)");
                gradient.addColorStop(0.8, "rgba(145,128,80,0)");
                return gradient;
              },
              borderColor: "#918050",
              borderWidth: 2,
              tension: isCurve ? 0.4 : 0,
              pointBackgroundColor: radialDotGradient,
              pointRadius: 8,
              pointHoverRadius: 10,
            },
            {
              label: "매출",
              data: [2, 9, 7, 5, 10],
              fill: true,
              backgroundColor: function (context) {
                const chart = context.chart;
                const gradient = chart.ctx.createLinearGradient(
                  0,
                  0,
                  0,
                  chart.height
                );
                gradient.addColorStop(0, "rgba(36,148,115,0.6)");
                gradient.addColorStop(0.9, "rgba(36,148,115,0)");
                return gradient;
              },
              borderColor: "#249473",
              borderWidth: 2,
              tension: isCurve ? 0.4 : 0,
              pointBackgroundColor: radialDotGradient,
              pointRadius: 8,
              pointHoverRadius: 10,
            },
          ],
        },
        options: {
          responsive: true,
          plugins: { legend: { display: true } },
          scales: {
            y: { beginAtZero: true, grid: { color: "#eee" } },
            x: { grid: { color: "#eee" } },
          },
        },
      });
    </script>
  </body>
</html>
